# Learning Git #

- Author : Ikuo Oeda
- Date : 2017/05/27


## 目次 ##

- 今回の目的
- Gitとは
- Gitの内部構成
- ブランチの使い方
- リモートリポジトリからの取得
- コマンドのおさらい
- GitHubの使い方
- その他のコマンド


## 今回の目的 ##

今回の目的はGitを使ったことがない、またはGitを使ったことはあるが
内部での仕組みについてあまり理解できていない方を対象とした内容です。<br/>
Gitの基本的な使い方とその仕組みを紹介しますが、完全に理解出来なくても構いません。<br/>
Gitは理解するのが難しいツールなので実際に使っていく中で徐々に理解を深めていくしかありません。<br/>
今回の内容はその一助となればと思います。


## Gitとは ##

### Gitの概要 ###

[wikipediaより](https://ja.wikipedia.org/wiki/Git)

>Gitは、プログラムのソースコードなどの変更履歴を記録・追跡するための**分散型バージョン管理システム**である。
>Linuxカーネルのソースコード管理に用いるためにリーナス・トーバルズによって開発され、それ以降ほかの多くのプロジェクトで採用されている。
>Linuxカーネルのような巨大プロジェクトにも対応できるように、動作速度に重点が置かれている。現在のメンテナンスは濱野純 (Junio C Hamano) が担当している。
>Gitでは、各ユーザのワーキングディレクトリに、全履歴を含んだリポジトリの完全な複製が作られる。
>したがって、ネットワークにアクセスできないなどの理由で中心リポジトリにアクセスできない環境でも、履歴の調査や変更の記録といったほとんどの作業を行うことができる
>これが「**分散型**」と呼ばれる理由である。

### バージョン管理システム ###

ファイルの作成・編集・削除などの情報をログの様に履歴として管理してくれるシステム。システムに変更を追加すると変更変更情報が保存される。
保存された変更履歴は意図的に削除しない限りは残り、変更点の確認やある時点の状態の復元などを行える。
また、この変更履歴を保存、管理している部分を**リポジトリ**と呼ぶ
よく使われているバージョン管理システムには以下の2つがある。

- Subversion(SVN)
- Git

### 分散型(バージョン管理システム) ###

SVNは1つのプロジェクト開発につき1つのリポジトリが存在し、このリポジトリの中でのみ履歴の管理が行われる。<br/>
このように1つのリポジトリで完結するものを集中型と呼ぶ。<br/>
対してGitの様に複数のリポジトリにて変更の管理を行うものを分散型と呼ぶ。


## Gitの内部構成 ##

### SVNとGitの構成の違い ###

SVNはワークスペースからリモートリポジトリに対して変更を追加(コミット)する。<br/>
対してGitはワークスペースとリモートリポジトリの間にローカルリポジトリが存在する。<br/>
イメージとしてはSVNのリモートリポジトリがローカルリポジトリとなり、さらに**リモートリポジトリの後に
もう一つリポジトリが追加されている**と考えるとよい。

### ワークツリー(ワークスペース) ###

Gitの管理が行われるディレクトリ全体を指す。<br/>
.gitフォルダが存在し、この中に変更履歴などの情報を格納する。<br/>
*add*コマンドによってインデックスに追加することでGitの管理下に置かれる。<br/>
.gitignoreファイルでファイルやフォルダを指定すると明示的にGitの管理下から外すことができる。

### ローカルリポジトリ ###

自分のマシン内に存在するリポジトリ<br/>
変更を追加する場合、このローカルリポジトリに追加する。<br/>
変更を追加することを**コミット**と言い、*commit*コマンドによって行う。<br>
また、コミットされた履歴のことを**リビジョン**と呼び、特に現在の最新(一番最近にコミットされた)リビジョンを**HEAD**と呼ぶ。

### リモートリポジトリ ###

自分のマシン**外**のリポジトリ。<br/>
通常はサーバにある一つのリポジトリをリモートリポジトリとし、メンバー間の変更を集約する。
(※複数のリモートリポジトリを使用することも可能)<br/>
*push*コマンドを使用することによってリモートリポジトリを自分のローカルリポジトリの状態に**同期**することができる。<br/>
この同期を行う行為を**プッシュ**と呼ぶ。<br/>
※ただし、後述するマージを行わなければならない状態の時はプッシュを行うことはできない。


## ブランチの使い方 ##

### ブランチとは ###

Gitには1つのリポジトリにて複数の開発を行えるような機能があり、これを**ブランチ**と呼ぶ。<br/>
現在所属しているブランチから新たなブランチの作成を行うと、それは独立した環境となりその他のブランチにて行われた
作業の影響をうけずにすむ。<br/>
そして、一定の作業を終えたところで、他のブランチの変更を取り込んだり、逆に取り込ませることができる。<br/>
一番最初に自動的に作成されるブランチを**masterブランチ**と呼ぶ。

### ブランチの作成と移動 ###

ブランチの作成と移動は*branch*コマンドと*checkout*コマンドによって行う。<br/>
*branch*コマンドでは存在するブランチの確認や新規作成、削除などを行うことができる。<br/>
*checkout*コマンドは指定したリビジョンの状態にワークスペースを変更することができる。<br/>
*checkout*コマンドでブランチ名を指定すると、そのブランチのHEADリビジョンに変更される。

### コミットの枝分かれ ###

同じリビジョンから作成したブランチにそれぞれコミットを行うとログ上でコミットが枝分かれしたようになる。<br/>
Gitではこのような形で並行開発を行う事が基本となる。<br/>
また、同一のブランチに複数人でコミットを行いリモートリポジトリにプッシュを行うと同様にコミットが枝分かれした状態になる。<br/>
この状態だとプッシュを行うことができなくなるのでマージを行い枝分かれを解消する必要がある。

### ブランチ間のマージ ###

2つのブランチを1つにまとめることを**マージ**と呼び*merge*コマンドを使用して行う。<br/>
マージを行うと2つのブランチの差分となるコミットを一つにまとめた**マージコミット**を作成する。<br/>
マージ自体は基本的にはGitが自動的に行ってくれるが同ファイルの同行に別々の変更が加えられた場合などは
**コンフリクト(衝突)**が起きるので手動にて修正を行いマージコミットを作成する。

## リモートリポジトリからの取得 ##

### リモートリポジトリの状態の取得 ###

プッシュによってローカルリポジトリからリモートリポジトリに状態を同期したのと逆にリモートリポジトリの状態をローカルリポジトリに
同期させることを**フェッチ**と呼び*fetch*コマンドによって行う。<br/>
フェッチを行うとローカルリポジトリに{リモートリポジトリ名}/{ブランチ名}のブランチが作成される。<br/>
これを**無名ブランチ**と呼びリモートリポジトリの状態が保持される。また、リモートリポジトリに変更があった場合は
再度フェッチすることにより同期が取られる。

## 特定ブランチのフェッチ ##

フェッチとは別に、ローカルリポジトリの特定のブランチに対してリモートリポジトリの特定のブランチの状態を反映させることもできる。<br/>
これを**プル**と呼び*pull*コマンドによって行う。<br/>
プルを行うと現在のブランチに対して指定したリモートのブランチの**無名ブランチをフェッチし、マージを行う**。<br/>
マージを実施しているため、枝分かれしたコミットを持っている場合マージコミットが作成される。


## コマンドのおさらい ##

### add ###

ワークツリーに新規に追加されたファイル(フォルダ)をインデックスに追加しGitの管理下に加える。<br/>
インデックスに追加したくないものについては.gitignoreファイルに記述することで無視される。

### commit ###

インデックスに追加されているファイルの変更を履歴としてローカルリポジトリに保存する。<br/>
コミットによって保存される情報は以下になります。

- tree: 現在の状態(スナップショット)
- parent: 親のコミット(一つ前のコミット)
- author: コミットを作成したユーザーと作成日時
- committer: コミットを実行したユーザーと実行日時

### push ###

ローカルリポジトリの状態をリモートリポジトリに反映させる。<br/>
枝分かれしたコミットが存在すると失敗する。

### branch ###

ブランチの確認・作成・削除を行う。

- branch: 存在するブランチの確認を行う
- branch {ブランチ名}: 指定したブランチ名で新規のブランチを作成する
- branch -delete: 指定したブランチの削除を行う

### checkout ###

ワークツリーを特定のリビジョンの状態に変更する。<br/>
ブランチ名を指定するとそのブランチに移動しHEADの状態にワークツリーを変更する。

### merge ###

枝分かれをしたコミットを一つにまとめマージコミットを作成する。<br/>
基本的には自動で判断し一つにまとめてくれるがコンフリクトが発生した場合は手動で修正とコミットが必要。

### fetch ###

リモートリポジトリの状態を取得し無名ブランチを作成する。

### pull ###

特定のブランチに対してフェッチとマージを行う。


## GitHubの使い方 ##

- リポジトリの取得
-- clone
- ファイルの追加
- リモートへのpush
- PRの作成


## その他のコマンド ##

### init ###

.gitフォルダを作成しそのディレクトリをGit管理下のディレクトリにする。

### status ###

現在のブランチの状態を表示する。<br/>
まだインデックスに登録されていないファイルや変更の存在するファイルが表示される。

### reset ###

現在のブランチを特定のレビジョンの状態へと変更する。<br/>
チェックアウトと違いリビジョンの状態の変更なので指定したリビジョンの後にコミットがあったとしても
削除される。

### revert ###

特定のコミットを無かったことにする。<br/>
コミット自体を削除するのではなく、そのコミットの変更を元に戻すコミットを作成し適用するので
元のコミットログ自体は残る。

### rebase ###

![https://wac-cdn-a.atlassian.com/dam/jcr:e4a40899-636b-4988-9774-eaa8a440575b/02.svg?cdnVersion=en](../../img/02.svg)

マージコミットを作らずにブランチを一つにまとめるコマンド。<br/>
特定のリビジョンに対してその差分となるコミットをそのリビジョンの後ろに付け替えるように移動する。

### stash ###

コミット前の変更を退避させる。<br/>
退避させた変更は*list*オプションで確認でき*apply*オプション、または*pop*オプションで戻すことができる。

### log ###

変更履歴の一覧を表示する。

### reflog ###

コミットの変更履歴ではなく、そのマシン内のGitの**操作履歴**を表示する。<br/>
表示された操作履歴に対しては*reset*コマンドでその状態に戻すことができる。

### update-index ###

インデックスを管理するコマンド。<br/>
以下のオプションを使用するとインデックスに登録したファイルの変更を無視することができる。

- assume-unchanged: ワークツリーに変更があっても無視をされる
- skip-worktree: Gitの管理下(操作対象)からファイルを外す
